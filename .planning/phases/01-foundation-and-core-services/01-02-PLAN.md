---
phase: 01-foundation-and-core-services
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/zoom/verifier.ts
  - src/services/zoom/background-manager.ts
  - src/utils/platform.ts
autonomous: true
requirements: [ZOOM-01, ZOOM-02, ZOOM-03]

must_haves:
  truths:
    - "Tool detects when Zoom app is not installed"
    - "Tool detects when user has not logged into Zoom"
    - "Tool finds Zoom backgrounds directory without hardcoded paths"
  artifacts:
    - path: "src/services/zoom/verifier.ts"
      provides: "Zoom installation and login verification"
      exports: ["ZoomVerifier"]
      min_lines: 30
    - path: "src/services/zoom/background-manager.ts"
      provides: "Dynamic Zoom backgrounds directory discovery"
      exports: ["BackgroundManager"]
      min_lines: 40
    - path: "src/utils/platform.ts"
      provides: "macOS-specific path utilities"
      exports: ["getHomeDir", "getZoomAppPath", "getZoomDataDir"]
      min_lines: 20
  key_links:
    - from: "src/services/zoom/verifier.ts"
      to: "node:fs"
      via: "existsSync for app bundle check"
      pattern: "existsSync.*zoom\\.us\\.app"
    - from: "src/services/zoom/background-manager.ts"
      to: "node:fs/promises"
      via: "glob for directory discovery"
      pattern: "glob.*Virtual.*Custom"
    - from: "src/services/zoom/verifier.ts"
      to: "src/services/errors.ts"
      via: "throws ZoomNotInstalledError, ZoomNotLoggedInError"
      pattern: "throw new Zoom"
---

<objective>
Implement Zoom integration services: installation verification, login state detection, and dynamic backgrounds directory discovery with fallback search patterns.

Purpose: Enables the tool to safely interact with Zoom by verifying prerequisites and locating the backgrounds directory across different Zoom versions. Dynamic path discovery prevents breakage when Zoom updates change directory structure.

Output: ZoomVerifier and BackgroundManager services ready for file operations in Phase 2.
</objective>

<execution_context>
@/Users/tvellore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tvellore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/tvellore/work/.planning/PROJECT.md
@/Users/tvellore/work/.planning/ROADMAP.md
@/Users/tvellore/work/.planning/STATE.md
@/Users/tvellore/work/.planning/phases/01-foundation-and-core-services/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create platform utilities for macOS paths</name>
  <files>src/utils/platform.ts</files>
  <action>
    Create platform-specific path utility functions for Zoom integration:

    1. Import homedir from 'node:os' and join from 'node:path'
    2. Implement getHomeDir(): returns homedir() - never use tilde (~) expansion, always use os.homedir()
    3. Implement getZoomAppPath(): returns '/Applications/zoom.us.app' (standard macOS app location)
    4. Implement getZoomDataDir(): returns join(getHomeDir(), 'Library', 'Application Support', 'zoom.us', 'data')
    5. Export all functions

    WHY NOT TILDE: Node.js path module does not expand ~ to home directory (shell feature only). Always use os.homedir() per RESEARCH.md Pitfall 6 (lines 451-466).
  </action>
  <verify>
    - src/utils/platform.ts exports getHomeDir, getZoomAppPath, getZoomDataDir
    - File uses os.homedir() not tilde expansion
    - File compiles without TypeScript errors
  </verify>
  <done>
    Platform utilities exist providing macOS-specific paths for Zoom integration.
  </done>
</task>

<task type="auto">
  <name>Create Zoom verifier for installation and login checks</name>
  <files>src/services/zoom/verifier.ts</files>
  <action>
    Create ZoomVerifier class that checks Zoom prerequisites:

    1. Import existsSync from 'node:fs', join from 'node:path'
    2. Import getZoomAppPath, getZoomDataDir from '../../utils/platform.js' (use .js extension for ESM)
    3. Import ZoomNotInstalledError, ZoomNotLoggedInError from '../errors.js'
    4. Implement ZoomVerifier class:
       - isInstalled(): Check both app bundle exists AND executable exists at join(appPath, 'Contents', 'MacOS', 'zoom.us')
         Returns boolean, does not throw
       - isLoggedIn(): Check data directory exists using getZoomDataDir()
         Returns boolean, does not throw
       - verify(): Calls isInstalled(), if false throw ZoomNotInstalledError. Then calls isLoggedIn(), if false throw ZoomNotLoggedInError. Returns void.
    5. Export ZoomVerifier as default export

    CRITICAL: Check both app bundle AND executable to avoid false positives from incomplete installations. Data directory only exists after first login per RESEARCH.md Pitfall 3 (lines 388-408).

    Reference pattern from RESEARCH.md macOS App Bundle Detection (lines 549-577).
  </action>
  <verify>
    - src/services/zoom/verifier.ts exports ZoomVerifier class
    - verify() method throws ZoomNotInstalledError when app missing
    - verify() method throws ZoomNotLoggedInError when data dir missing
    - File compiles without TypeScript errors
  </verify>
  <done>
    ZoomVerifier exists with isInstalled, isLoggedIn, and verify methods that check Zoom prerequisites.
  </done>
</task>

<task type="auto">
  <name>Create background manager with dynamic directory discovery</name>
  <files>src/services/zoom/background-manager.ts</files>
  <action>
    Create BackgroundManager class with fallback directory search:

    1. Import glob from 'node:fs/promises', existsSync from 'node:fs', join from 'node:path'
    2. Import getZoomDataDir from '../../utils/platform.js'
    3. Import ZoomNotLoggedInError from '../errors.js'
    4. Implement BackgroundManager class:
       - Private property searchPaths: array of known directory names ['VirtualBkgnd_Custom', 'VirtualBackground_Custom', 'Backgrounds', 'CustomBackgrounds']
       - findBackgroundsDirectory(): async method
         a. Get baseDir from getZoomDataDir()
         b. Check if baseDir exists, if not throw ZoomNotLoggedInError
         c. Fast path: Loop through searchPaths, check if join(baseDir, dirName) exists, return first match
         d. Fallback: Use glob with pattern join(baseDir, '**/*Virtual*Custom*') to search recursively
         e. Filter glob results for directories only (entry.isDirectory())
         f. Return first match from glob results
         g. If no matches, throw Error with helpful message listing searchPaths tried
    5. Export BackgroundManager as default export

    WHY MULTIPLE PATTERNS: Zoom has changed directory names across versions with no documentation. Research confirmed VirtualBkgnd_Custom on current version, but fallback patterns handle other versions per RESEARCH.md Pitfall 2 (lines 369-385).

    Reference pattern from RESEARCH.md Pattern 4 and Dynamic Directory Search (lines 237-285, 579-622).
  </action>
  <verify>
    - src/services/zoom/background-manager.ts exports BackgroundManager class
    - findBackgroundsDirectory() method searches multiple directory name patterns
    - Method includes fallback glob search with '**/*Virtual*Custom*' pattern
    - File compiles without TypeScript errors
  </verify>
  <done>
    BackgroundManager exists with findBackgroundsDirectory method that dynamically discovers Zoom backgrounds directory with multiple fallback patterns.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Run `tsc --noEmit` to verify TypeScript compilation
2. Check that src/services/zoom/verifier.ts checks both app bundle AND executable
3. Check that src/services/zoom/background-manager.ts has multiple search patterns in searchPaths array
4. Verify all imports use .js extensions for ESM compatibility
5. Confirm error types (ZoomNotInstalledError, ZoomNotLoggedInError) are imported and thrown appropriately
</verification>

<success_criteria>
- [ ] ZoomVerifier can detect Zoom installation status (app bundle + executable check)
- [ ] ZoomVerifier can detect Zoom login status (data directory check)
- [ ] BackgroundManager searches multiple directory name patterns
- [ ] BackgroundManager includes glob fallback for unknown directory structures
- [ ] Platform utilities provide macOS-specific paths using os.homedir() not tilde
- [ ] All files compile with `tsc --noEmit`
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-core-services/01-02-SUMMARY.md`
</output>
